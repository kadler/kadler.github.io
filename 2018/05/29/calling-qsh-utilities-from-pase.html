<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Calling QSH utilities from PASE - Kevin’s Ramblings</title>
<meta name="description" content="QSH provides a wonderful utility called db2 which allows you to run SQL queries from within the QSH shell, but what if you’re in a QP2TERM shell or using SSH - what then?">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Kevin's Ramblings">
<meta property="og:title" content="Calling QSH utilities from PASE">
<meta property="og:url" content="https://kadler.io/2018/05/29/calling-qsh-utilities-from-pase.html">


  <meta property="og:description" content="QSH provides a wonderful utility called db2 which allows you to run SQL queries from within the QSH shell, but what if you’re in a QP2TERM shell or using SSH - what then?">







  <meta property="article:published_time" content="2018-05-29T10:43:00-05:00">






<link rel="canonical" href="https://kadler.io/2018/05/29/calling-qsh-utilities-from-pase.html">













<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Kevin's Ramblings Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">Kevin's Ramblings</a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/posts/">Posts</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/year-archive/">Archive</a>
            </li>
<li class="masthead__menu-item">
              <a href="/ebcdic/">EBCDIC</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/bio-photo.jpg" alt="Kevin Adler" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Kevin Adler</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Open Source Dude</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Rochester, MN</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/kadler" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://mastodon.lol/@kadler" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i><span class="label">Mastodon</span></a></li>
          
        
          
            <li><a href="https://twitter.com/kadlerio" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://stackoverflow.com/users/3245633/kevin-adler" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/kevin-adler-19038a15" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://bitbucket.org/kadler" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-bitbucket" aria-hidden="true"></i><span class="label">BitBucket</span></a></li>
          
        
          
            <li><a href="https://gitlab.com/kadler" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-gitlab" aria-hidden="true"></i><span class="label">GitLab</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Calling QSH utilities from PASE">
    <meta itemprop="description" content="QSH provides a wonderful utility called db2 which allows you to run SQL queries from within the QSH shell, but what if you’re in a QP2TERM shell or using SSH - what then?">
    <meta itemprop="datePublished" content="May 29, 2018">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Calling QSH utilities from PASE
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>QSH provides a wonderful utility called <code class="language-plaintext highlighter-rouge">db2</code> which allows you to run SQL queries from within the QSH shell, but what if you’re in a QP2TERM shell or using SSH - what then?</p>
      <h2 id="qsh-from-pase">
        
        
          QSH from PASE <a href="#qsh-from-pase"></a>
        
        
      </h2>

<p>Well, PASE provides a <code class="language-plaintext highlighter-rouge">qsh</code> utility which allows you to call programs within the QSH environment. Like most shells, QSH provides a <code class="language-plaintext highlighter-rouge">-c</code> option, which allows you to pass a string of commands to be executed instead of reading from <code class="language-plaintext highlighter-rouge">stdin</code>, so we can call <code class="language-plaintext highlighter-rouge">db2</code> like so:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-bash-4</span>.3<span class="nv">$ </span>qsh <span class="nt">-c</span> <span class="s2">"db2 'select 30 from sysibm.sysdummy1'"</span>

00001      
<span class="nt">-----------</span>
         30

  1 RECORD<span class="o">(</span>S<span class="o">)</span> SELECTED.

</code></pre></div></div>

<p>Notice that we had to quote the commands twice. What happens if we need to use quotes inside our SQL?</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-bash-4</span>.3<span class="nv">$ </span>qsh <span class="nt">-c</span> <span class="s2">"db2 </span><span class="se">\"</span><span class="s2">select message_id, message_timestamp from table(qsys2.joblog_info('*')) x</span><span class="se">\"</span><span class="s2">"</span>

MESSAGE_ID  MESSAGE_TIMESTAMP         
<span class="nt">-----------</span> <span class="nt">--------------------------</span>
CPC7301     2018-05-29-10.50.07.842411

  1 RECORD<span class="o">(</span>S<span class="o">)</span> SELECTED.

</code></pre></div></div>

<p>Since you can’t escape inside a single-quoted string, we had to switch to using double quotes around the SQL statement and then had to escape those, since they’re inside a double quoted string already. This is starting to get messy. Now what if we need to use delimited names?</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-bash-4</span>.3<span class="nv">$ </span>qsh <span class="nt">-c</span> <span class="s2">"db2 </span><span class="se">\"</span><span class="s2">select message_id, message_timestamp from table(</span><span class="se">\\\"</span><span class="s2">QSYS2</span><span class="se">\\\"</span><span class="s2">.</span><span class="se">\\\"</span><span class="s2">JOBLOG_INFO</span><span class="se">\\\"</span><span class="s2">('*')) x</span><span class="se">\"</span><span class="s2">"</span>

MESSAGE_ID  MESSAGE_TIMESTAMP         
<span class="nt">-----------</span> <span class="nt">--------------------------</span>
CPC7301     2018-05-29-10.52.08.632485

  1 RECORD<span class="o">(</span>S<span class="o">)</span> SELECTED.
</code></pre></div></div>

<p>Ugh! Now we had to double-escape the quoted strings! That’s nearly vomit inducing!</p>
    
      <h2 id="symlink-trickery">
        
        
          Symlink Trickery <a href="#symlink-trickery"></a>
        
        
      </h2>

<p>One thing you may not have realized is that the PASE <code class="language-plaintext highlighter-rouge">qsh</code> utility has a few tricks up its sleeve. Try this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-bash-4</span>.3<span class="nv">$ </span><span class="nb">ln</span> <span class="nt">-s</span> /QOpenSys/usr/bin/qsh /QOpenSys/usr/bin/db2
<span class="nt">-bash-4</span>.3<span class="nv">$ </span>db2 <span class="s2">"select message_id, message_timestamp from table(</span><span class="se">\"</span><span class="s2">QSYS2</span><span class="se">\"</span><span class="s2">.</span><span class="se">\"</span><span class="s2">JOBLOG_INFO</span><span class="se">\"</span><span class="s2">('*')) x"</span>

MESSAGE_ID  MESSAGE_TIMESTAMP         
<span class="nt">-----------</span> <span class="nt">--------------------------</span>
CPD000D     2018-05-29-10.54.07.331486
CPC7301     2018-05-29-10.54.07.335762

  2 RECORD<span class="o">(</span>S<span class="o">)</span> SELECTED.

</code></pre></div></div>

<p>Now you can call db2 “directly” and everything just works! No messing with <code class="language-plaintext highlighter-rouge">qsh -c</code> and less escaping. But how does it work?</p>
    
      <h2 id="diving-under-the-hood">
        
        
          Diving Under the Hood <a href="#diving-under-the-hood"></a>
        
        
      </h2>

<p>The <code class="language-plaintext highlighter-rouge">qsh</code> PASE command is actually a shell script and it has special code to check what the first argument was. The first argument, being stored at index 0 is the name and path of the program which was run (in shell scripts, this is the <code class="language-plaintext highlighter-rouge">$0</code> variable). By creating a symlink to the same shell script called <code class="language-plaintext highlighter-rouge">db2</code>, when it gets called it will think it’s the <code class="language-plaintext highlighter-rouge">db2</code> program instead of <code class="language-plaintext highlighter-rouge">qsh</code>. Thus, instead of calling <code class="language-plaintext highlighter-rouge">/usr/bin/qsh</code>, the script will call <code class="language-plaintext highlighter-rouge">/usr/bin/db2</code> instead! You can do this with any IBM i program you want, so long as there’s a symlink in <code class="language-plaintext highlighter-rouge">/usr/bin</code> (just be aware that for RPG and CL programs, the parameters need to be padded out).</p>

<p>One thing to note is that when you call programs this way instead of using <code class="language-plaintext highlighter-rouge">qsh -c</code>, they will run in a multi-threaded job, which may give you issues. If that is a problem, you can always make a copy of the <code class="language-plaintext highlighter-rouge">qsh</code> script and remove the <code class="language-plaintext highlighter-rouge">-i</code> argument to <code class="language-plaintext highlighter-rouge">system</code> on the last line of the script, then symlink to your <code class="language-plaintext highlighter-rouge">qsh</code> copy instead. This will cause <code class="language-plaintext highlighter-rouge">system</code> to execute in a new job, just as <code class="language-plaintext highlighter-rouge">qsh -c</code> would have.</p>
    
      <h2 id="use-it-or-lose-it">
        
        
          Use it or Lose it <a href="#use-it-or-lose-it"></a>
        
        
      </h2>

<p>Just remember that the program name is an argument just like any other and you can take advantage of it in your own programs! In shell scripts you can use the special variable <code class="language-plaintext highlighter-rouge">$0</code>; in Python use <code class="language-plaintext highlighter-rouge">sys.argv[0]</code>; and in C/C++ it’s in <code class="language-plaintext highlighter-rouge">argv[0]</code> (in PASE this gives you <code class="language-plaintext highlighter-rouge">/path/to/program</code>, while in ILE it gives you <code class="language-plaintext highlighter-rouge">LIBRARY/PROGRAM</code>).</p>

<p>Are there any situations you can think of where this would be useful?</p>
        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/pase" class="page__taxonomy-item" rel="tag">pase</a><span class="sep">, </span>
    
      
      
      <a href="/categories/qsh" class="page__taxonomy-item" rel="tag">qsh</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-05-29T10:43:00-05:00">May 29, 2018</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/2018/01/08/fetching-python-database-cursors-by-column-name.html" class="pagination--pager" title="Fetching Python Database Cursors by Column Name
">Previous</a>
    
    
      <a href="/2018/09/20/using-python-ibm-db-with-un-journaled-files.html" class="pagination--pager" title="Using Python ibm_db with Un-journaled Tables
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/05/20/odbc-repos.html" rel="permalink">IBM-provided Repositories ODBC Linux Driver Repositories
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Today, we’re pushing out something that I’ve been wanting for a long time. We
now have RPM and DEB repositories for Linux available directly from IBM for the...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/02/21/jan-2022-oss-updates.html" rel="permalink">IBM i Open Source Updates January 2022
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Happy new year! I know it’s late February now, but it’s still the first post of
2022 here, so let’s see what January had to offer. <img class="emoji" title=":grin:" alt=":grin:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f601.png" height="20" width="20">
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/01/31/dec-2021-oss-updates.html" rel="permalink">IBM i Open Source Updates December 2021
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Just because the last couple months were quiet doesn’t mean that nothing’s
going on. Case in point, the last month of 2021 saw a ton of updates, though
many ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/01/24/nov-2021-oss-updates.html" rel="permalink">IBM i Open Source Updates November 2021
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">November brings some nice goodies for IBM i 7.3+ users and some security fixes.
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2023 Kevin's Ramblings. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
