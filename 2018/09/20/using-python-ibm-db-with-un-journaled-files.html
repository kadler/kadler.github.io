<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Using Python ibm_db with Un-journaled Tables - Kevin’s Ramblings</title>
<meta name="description" content="When using the Python ibm_db package to interact with the Db2 for i database, you may run in to this error:">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Kevin's Ramblings">
<meta property="og:title" content="Using Python ibm_db with Un-journaled Tables">
<meta property="og:url" content="https://kadler.io/2018/09/20/using-python-ibm-db-with-un-journaled-files.html">


  <meta property="og:description" content="When using the Python ibm_db package to interact with the Db2 for i database, you may run in to this error:">







  <meta property="article:published_time" content="2018-09-20T00:00:00-05:00">






<link rel="canonical" href="https://kadler.io/2018/09/20/using-python-ibm-db-with-un-journaled-files.html">













<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Kevin's Ramblings Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">Kevin's Ramblings</a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/posts/">Posts</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/year-archive/">Archive</a>
            </li>
<li class="masthead__menu-item">
              <a href="/ebcdic/">EBCDIC</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/bio-photo.jpg" alt="Kevin Adler" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Kevin Adler</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Open Source Dude</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Rochester, MN</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/kadler" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://mastodon.lol/@kadler" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i><span class="label">Mastodon</span></a></li>
          
        
          
            <li><a href="https://twitter.com/kadlerio" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://stackoverflow.com/users/3245633/kevin-adler" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/kevin-adler-19038a15" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://bitbucket.org/kadler" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-bitbucket" aria-hidden="true"></i><span class="label">BitBucket</span></a></li>
          
        
          
            <li><a href="https://gitlab.com/kadler" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-gitlab" aria-hidden="true"></i><span class="label">GitLab</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Using Python ibm_db with Un-journaled Tables">
    <meta itemprop="description" content="When using the Python ibm_db package to interact with the Db2 for i database, you may run in to this error:">
    <meta itemprop="datePublished" content="September 20, 2018">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Using Python ibm_db with Un-journaled Tables
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>When using the Python ibm_db package to interact with the Db2 for i database, you may run in to this error:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'insert into qtemp.foo values(1)'</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"/QOpenSys/pkgs/lib/python3.6/site-packages/ibm_db_dbi.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1311</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_execute_helper</span>
    <span class="n">return_value</span> <span class="o">=</span> <span class="n">ibm_db</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">stmt_handler</span><span class="p">)</span>
<span class="nb">Exception</span><span class="p">:</span> <span class="n">Statement</span> <span class="n">Execute</span> <span class="n">Failed</span><span class="p">:</span> <span class="n">FOO</span> <span class="ow">in</span> <span class="n">QTEMP</span> <span class="ow">not</span> <span class="n">valid</span> <span class="k">for</span> <span class="n">operation</span><span class="p">.</span> <span class="n">SQLSTATE</span><span class="o">=</span><span class="mi">55019</span> <span class="n">SQLCODE</span><span class="o">=-</span><span class="mi">7008</span>

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
  <span class="n">File</span> <span class="s">"/QOpenSys/pkgs/lib/python3.6/site-packages/ibm_db_dbi.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1396</span><span class="p">,</span> <span class="ow">in</span> <span class="n">execute</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">_execute_helper</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
  <span class="n">File</span> <span class="s">"/QOpenSys/pkgs/lib/python3.6/site-packages/ibm_db_dbi.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1321</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_execute_helper</span>
    <span class="k">raise</span> <span class="bp">self</span><span class="p">.</span><span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ibm_db_dbi</span><span class="p">.</span><span class="n">ProgrammingError</span><span class="p">:</span> <span class="n">ibm_db_dbi</span><span class="p">::</span><span class="n">ProgrammingError</span><span class="p">:</span> <span class="n">Statement</span> <span class="n">Execute</span> <span class="n">Failed</span><span class="p">:</span> <span class="n">FOO</span> <span class="ow">in</span> <span class="n">QTEMP</span> <span class="ow">not</span> <span class="n">valid</span> <span class="k">for</span> <span class="n">operation</span><span class="p">.</span> <span class="n">SQLSTATE</span><span class="o">=</span><span class="mi">55019</span> <span class="n">SQLCODE</span><span class="o">=-</span><span class="mi">7008</span>
</code></pre></div></div>

<p>The problem is that tables in un-journaled libraries cannot be modified when run under commitment control and ibm_db uses the IBM CLI default of <code class="language-plaintext highlighter-rouge">*CHG</code>.</p>

<p>There’s two ways to fix this:</p>

<ol>
  <li>Modify your SQL to specify <code class="language-plaintext highlighter-rouge">WITH NC</code>
</li>
  <li>Disable commitment control in ibm_db</li>
</ol>

<p>Luckily, ibm_db allows the user to set arbitrary IBM CLI statement and connection attributes using the <code class="language-plaintext highlighter-rouge">set_option</code> method on the cursor or connection object. The only problem with this is you need to know what the integer values are for the attributes and their values, which means digging through IBM CLI header files or looking through the documentation.</p>

<p>With ibm_db 2.0.5.7 and higher, <code class="language-plaintext highlighter-rouge">SQL_ATTR_TXN_ISOLATION</code> and the values associated with it are now defined by the <code class="language-plaintext highlighter-rouge">ibm_db_dbi</code> module for easy reference. The values you can use are:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">SQL_TXN_READ_UNCOMMITTED</code> (<code class="language-plaintext highlighter-rouge">*CHG</code> or <code class="language-plaintext highlighter-rouge">*UR</code>)</li>
  <li>
<code class="language-plaintext highlighter-rouge">SQL_TXN_READ_COMMITTED</code> (<code class="language-plaintext highlighter-rouge">*CS</code>)</li>
  <li>
<code class="language-plaintext highlighter-rouge">SQL_TXN_REPEATABLE_READ</code> (<code class="language-plaintext highlighter-rouge">*ALL</code> or <code class="language-plaintext highlighter-rouge">*RS</code>)</li>
  <li>
<code class="language-plaintext highlighter-rouge">SQL_TXN_SERIALIZABLE</code> (<code class="language-plaintext highlighter-rouge">*RR</code>)</li>
  <li>
<code class="language-plaintext highlighter-rouge">SQL_TXN_NO_COMMIT</code> (<code class="language-plaintext highlighter-rouge">*NONE</code> or <code class="language-plaintext highlighter-rouge">*NC</code>)</li>
</ul>

<p>Here’s an example using this new functionality:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">ibm_db_dbi</span> <span class="k">as</span> <span class="n">db2</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">db2</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">conn</span><span class="p">.</span><span class="n">set_option</span><span class="p">({</span> <span class="n">db2</span><span class="p">.</span><span class="n">SQL_ATTR_TXN_ISOLATION</span><span class="p">:</span>
                  <span class="n">db2</span><span class="p">.</span><span class="n">SQL_TXN_NO_COMMIT</span> <span class="p">})</span>

<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'create table qtemp.foo(i int)'</span><span class="p">)</span>
<span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'insert into qtemp.foo values(1)'</span><span class="p">)</span>
</code></pre></div></div>
        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/ibm-db" class="page__taxonomy-item" rel="tag">ibm_db</a><span class="sep">, </span>
    
      
      
      <a href="/categories/python" class="page__taxonomy-item" rel="tag">python</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-09-20T00:00:00-05:00">September 20, 2018</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/2018/05/29/calling-qsh-utilities-from-pase.html" class="pagination--pager" title="Calling QSH utilities from PASE
">Previous</a>
    
    
      <a href="/2018/09/28/using-system-naming-in-ibm_db.html" class="pagination--pager" title="Using System Naming in Python ibm_db
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/05/20/odbc-repos.html" rel="permalink">IBM-provided Repositories ODBC Linux Driver Repositories
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Today, we’re pushing out something that I’ve been wanting for a long time. We
now have RPM and DEB repositories for Linux available directly from IBM for the...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/02/21/jan-2022-oss-updates.html" rel="permalink">IBM i Open Source Updates January 2022
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Happy new year! I know it’s late February now, but it’s still the first post of
2022 here, so let’s see what January had to offer. <img class="emoji" title=":grin:" alt=":grin:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f601.png" height="20" width="20">
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/01/31/dec-2021-oss-updates.html" rel="permalink">IBM i Open Source Updates December 2021
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Just because the last couple months were quiet doesn’t mean that nothing’s
going on. Case in point, the last month of 2021 saw a ton of updates, though
many ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/01/24/nov-2021-oss-updates.html" rel="permalink">IBM i Open Source Updates November 2021
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">November brings some nice goodies for IBM i 7.3+ users and some security fixes.
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2023 Kevin's Ramblings. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
